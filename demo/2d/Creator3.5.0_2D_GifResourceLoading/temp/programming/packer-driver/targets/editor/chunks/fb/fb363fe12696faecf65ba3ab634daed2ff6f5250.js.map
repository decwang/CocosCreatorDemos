{"version":3,"sources":["file:///Users/mu/work/gitee/CocosCreatorDemos/demo/2d/Creator3.5.0_2D_GifResourceLoading/assets/GIF/GIF.ts"],"names":["GIF","GIFCache","FileHead","SpriteFrame","Texture2D","assetManager","loader","log","ImageAsset","JSB","LZW","FileType","_tab","_view","_frame","_buffer","_offset","_lastData","_info","header","frames","comment","_delays","_spriteFrames","_canvas","_context","id","async","buffer","clear","Uint8Array","handle","item","callback","getHeader","getScrDesc","getTexture","length","Error","delays","spriteFrames","detectFormat","data","indexOf","IMAGE_GIF","IMAGE_PNG","PNG","IMAGE_JPG","JPG","WEBP_RIFF","WEBP_WEBP","WEBP","UNKNOWN","bytes2HexString","arrBytes","str","i","tmp","num","toString","index","frame","decodeFrame2Texture","getSpriteFrame","decodeFrame","imageData","createImageData","img","w","h","getImageData","x","y","m","colorTab","decode","srcBuf","codeSize","forEach","j","k","ctrl","t","tranIndex","mergeFrames","lastImageData","curImageData","dataUrl2SpriteFrame","dataUrl","texture","spriteFrame","image","Image","src","width","height","onLoaded","date2SpriteFrame","_data","imageAsset","putImageDataJSB","cheeckNullPixel","checkAlpha","alphaCount","lineCount","indexData","replay","indexLastData","clearAndReplay","disp","putImageDataWeb","finalImageData","putImageData","clearRect","toDataURL","document","createElement","getContext","delay","read","len","slice","e","arr","String","fromCharCode","cr","s","pixel","bgColor","radio","extension","r","push","o","appVersion","gifFrameMap","getInstance","instance","downloader","register","_downloaders","url","options","onComplete","err","parser","parse","file","gif","console","jsb","fileUtils","getDataFromFile","arrayBuffer","preloadGif","words","load","error","classes","addItemFrame","key","frameData","has","get","referenceCount","gifCaheItem","type","addItemType","add","value","undefined","hasFrame","itemFrame","relase","release","releaseAll","RIFF"],"mappings":"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","sourcesContent":["\n\nimport { _decorator, SpriteFrame, Texture2D, RenderTexture, assetManager, loader, log, ImageAsset, game, find, Sprite } from 'cc';\nimport { JSB } from 'cc/env';\nimport LZW from \"./LZW\";\nexport enum FileType {\n    UNKNOWN,\n    PNG,\n    JPG,\n    GIF,\n    WEBP\n}\nclass GIF {\n    private _tab: any;\n    private _view: Uint8Array;\n    private _frame: any;\n    private _buffer: ArrayBuffer;\n    private _offset: number = 0;\n    private _lastData: ImageData;\n    private _info: any = {\n        header: '',\n        frames: [],\n        comment: ''\n    };\n    private _delays: Array<number> = [];\n    private _spriteFrames: Array<SpriteFrame> = [];\n    private _canvas: HTMLCanvasElement = null;\n    private _context: CanvasRenderingContext2D = null;\n    public id = \"GIF\"\n    public async = true\n    set buffer(buffer: ArrayBuffer) {\n        this.clear();\n        this._buffer = buffer;\n        this._view = new Uint8Array(buffer);\n    }\n    get buffer() {\n        return this._buffer;\n    }\n    handle(item, callback) {\n        this.buffer = item;\n        this.getHeader();\n        this.getScrDesc();\n        this.getTexture();\n        if (this._spriteFrames.length == 0) {\n            callback(new Error(\"gif加载失败,帧长度为0\"))\n        } else {\n            callback(null, { delays: this._delays, spriteFrames: this._spriteFrames, length: this._info.frames.length })\n        }\n    }\n    static detectFormat(data): FileType {\n        if (data.indexOf(FileHead.IMAGE_GIF) != -1) {\n            return FileType.GIF;\n        } else if (data.indexOf(FileHead.IMAGE_PNG) != -1) {\n            return FileType.PNG;\n        } else if (data.indexOf(FileHead.IMAGE_JPG) != -1) {\n            return FileType.JPG;\n        } else if (data.indexOf(FileHead.WEBP_RIFF) != -1 && data.indexOf(FileHead.WEBP_WEBP) != -1) {\n            return FileType.WEBP;\n        } else {\n            return FileType.UNKNOWN\n        }\n    }\n    static bytes2HexString(arrBytes) {\n        var str = \"\";\n        for (var i = 0; i < arrBytes.length; i++) {\n            var tmp;\n            var num = arrBytes[i];\n            if (num < 0) {\n                tmp = (255 + num + 1).toString(16);\n            } else {\n                tmp = num.toString(16);\n            }\n            if (tmp.length == 1) {\n                tmp = \"0\" + tmp;\n            }\n            str += tmp;\n        }\n        return str;\n    }\n    private getTexture() {\n        let index = 0;\n        // console.log(this._info.frames,'info')\n        for (const frame of this._info.frames) {\n            this.decodeFrame2Texture(frame, index++);\n        }\n    }\n    public getSpriteFrame(index) {\n        if (this._spriteFrames[index]) return this._spriteFrames[index];\n        return this.decodeFrame2Texture(this._info.frames[index], index);\n    }\n    private decodeFrame(frame) {\n        let imageData;\n        // console.log(frame,'frame')\n        if(JSB){\n            imageData = this._context.createImageData(frame.img.w, frame.img.h)\n\n        }else{\n            imageData = this._context.getImageData(frame.img.x, frame.img.y, frame.img.w, frame.img.h)\n\n        }\n        frame.img.m ? this._tab = frame.img.colorTab : this._tab = this._info.colorTab;\n        LZW.decode(frame.img.srcBuf, frame.img.codeSize).forEach((j, k) => {\n            imageData.data[k * 4] = this._tab[j * 3];\n            imageData.data[k * 4 + 1] = this._tab[j * 3 + 1];\n            imageData.data[k * 4 + 2] = this._tab[j * 3 + 2];\n            imageData.data[k * 4 + 3] = 255;\n            frame.ctrl.t ? (j == frame.ctrl.tranIndex ? imageData.data[k * 4 + 3] = 0 : 0) : 0;\n        });\n        return imageData;\n    }\n    private mergeFrames(lastImageData, curImageData) {\n        let imageData = curImageData;\n        if (lastImageData) {\n            for (var i = 0; i < imageData.data.length; i += 4) {\n                if (imageData.data[i + 3] == 0) {\n                    imageData.data[i] = this._lastData.data[i];\n                    imageData.data[i + 1] = this._lastData.data[i + 1];\n                    imageData.data[i + 2] = this._lastData.data[i + 2];\n                    imageData.data[i + 3] = this._lastData.data[i + 3];\n                }\n            }\n        }\n        return imageData;\n    }\n    private dataUrl2SpriteFrame(dataUrl) {\n        let texture = new Texture2D()\n        let spriteFrame = new SpriteFrame();\n        let image = new Image();\n        image.src = dataUrl;\n        image.width = this._canvas.width;\n        image.height = this._canvas.height;\n        let img = new ImageAsset(image);\n        img.onLoaded();\n        texture.image = img;\n        spriteFrame.texture = texture;\n        return spriteFrame;\n    }\n    private date2SpriteFrame(data, width, height) {\n        let texture = new Texture2D();\n        let spriteFrame = new SpriteFrame();\n        // spriteFrame = find('Canvas/test').getComponent(Sprite).spriteFrame\n        let image = new Image();\n        image.width = width;\n        image.height = height;\n        image._data = data._data;\n        // console.log(data._data,'  ==imagedata==  ',htm)\n        let imageAsset = new ImageAsset(image);\n\n        // image.reset({\n        //     _data: data._data,\n        //     _compressed: false,\n        //     width: width, \n        //     height: height,\n        //     format: Texture2D.PixelFormat.RGBA8888\n        // });\n        texture.image = imageAsset;\n        // console.log(image,'  ==image==  ',texture)\n        // texture._nativeAsset = data;\n        spriteFrame.texture = texture;\n        // spriteFrame.texture = texture;\n        return spriteFrame;\n    }\n    putImageDataJSB(imageData, x, y, frame) {\n        let cheeckNullPixel = () => {\n            if (imageData.data[0] == 4\n                && imageData.data[1] == 0\n                && imageData.data[2] == 0\n                && imageData.data[3] == 0) {\n                return true\n            }\n            return false\n        }\n        let checkAlpha = () => {\n            let alphaCount = 0\n            for (let i = 0; i < imageData.height; i += 2) {\n                let lineCount = 0\n                for (let j = 0; j < imageData.width; j++) {\n                    let indexData = i * 4 * imageData.width + 4 * j\n                    if (imageData.data[indexData + 3] == 0) {\n                        lineCount++\n                    }\n                }\n                if (lineCount / imageData.width > 0.1) {\n                    alphaCount++\n                }\n                if (alphaCount / (imageData.height / 2) > 0.6) return true\n            }\n            return false\n        }\n        let replay = () => {\n            for (let i = 0; i < imageData.height; i++) {\n                for (let j = 0; j < imageData.width; j++) {\n                    let indexData = i * 4 * imageData.width + 4 * j\n                    let indexLastData = (i + y) * 4 * this._lastData.width + 4 * (j + x)\n                    if (imageData.data[indexData + 3] != 0) {\n                        this._lastData.data[indexLastData] = imageData.data[indexData]\n                        this._lastData.data[indexLastData + 1] = imageData.data[indexData + 1]\n                        this._lastData.data[indexLastData + 2] = imageData.data[indexData + 2]\n                        this._lastData.data[indexLastData + 3] = imageData.data[indexData + 3]\n                    }\n                }\n            }\n        }\n        let clearAndReplay = () => {\n            for (let i = 0; i < this._lastData.height; i++) {\n                for (let j = 0; j < this._lastData.width; j++) {\n                    let indexLastData = i * 4 * this._lastData.width + 4 * j\n                    let indexData = (i - y) * 4 * imageData.width + 4 * (j - x)\n                    let clear = false\n                    if (j < x || j > (x + imageData.width)) {\n                        clear = true\n                    }\n                    if (i < y || i > (y + imageData.height)) {\n                        clear = true\n                    }\n                    if (clear) {\n                        this._lastData.data[indexLastData + 0] = 0;\n                        this._lastData.data[indexLastData + 1] = 0;\n                        this._lastData.data[indexLastData + 2] = 0;\n                        this._lastData.data[indexLastData + 3] = 0;\n                    } else {\n                        this._lastData.data[indexLastData + 0] = imageData.data[indexData + 0]\n                        this._lastData.data[indexLastData + 1] = imageData.data[indexData + 1]\n                        this._lastData.data[indexLastData + 2] = imageData.data[indexData + 2]\n                        this._lastData.data[indexLastData + 3] = imageData.data[indexData + 3]\n                    }\n                }\n            }\n        }\n        if (cheeckNullPixel()) {\n            return\n        }\n        if (frame.ctrl.disp == 1 || frame.ctrl.disp == 0) {\n            replay()\n        } else if (frame.ctrl.disp == 2) {\n            clearAndReplay()\n        } else {\n            if (checkAlpha()) {\n                clearAndReplay()\n            } else {\n                replay()\n            }\n        }\n    }\n    putImageDataWeb(imageData, frame) {\n        let finalImageData\n        if (frame.ctrl.disp == 1 || frame.ctrl.disp == 0) {\n            this._context.putImageData(imageData, frame.img.x, frame.img.y, 0, 0, frame.img.w, frame.img.h);\n            let curImageData = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\n            let lastImageData = this._lastData;\n            finalImageData = this.mergeFrames(lastImageData, curImageData);\n        } else {\n            this._context.clearRect(0, 0, this._canvas.width, this._canvas.height)\n            this._context.putImageData(imageData, frame.img.x, frame.img.y, 0, 0, frame.img.w, frame.img.h);\n            finalImageData = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\n        }\n        this._context.putImageData(finalImageData, 0, 0);\n        this._lastData = finalImageData;\n        return this._canvas.toDataURL();\n    }\n    private decodeFrame2Texture(frame, index) {\n        if (!this._context) {\n            this._canvas =document.createElement('canvas');\n            this._context = this._canvas.getContext('2d');\n            this._canvas.width = frame.img.w;\n            this._canvas.height = frame.img.h;\n        }\n        // console.log('decodeFrame2Texture')\n        let imageData = this.decodeFrame(frame);\n        this._delays[index] = frame.ctrl.delay;\n        if (JSB) {\n            if (!this._lastData) {\n                this._lastData = imageData\n            } else {\n                this.putImageDataJSB(imageData, frame.img.x, frame.img.y, frame);\n            }\n            this._spriteFrames[index] = this.date2SpriteFrame(this._lastData, this._canvas.width, this._canvas.height);\n        } else {\n            let dataUrl = this.putImageDataWeb(imageData, frame);\n\t    this._spriteFrames[index] = this.dataUrl2SpriteFrame(dataUrl);\n        }\n        return this._spriteFrames[index];\n    }\n    private read(len) {\n        return this._view.slice(this._offset, this._offset += len);\n    }\n    private getHeader() {\n        this._info.header = '';\n        this.read(6).forEach((e, i, arr) => {\n            this._info.header += String.fromCharCode(e);\n        });\n    }\n    private getScrDesc() {\n        var arr = this.read(7), i;\n        this._info.w = arr[0] + (arr[1] << 8);\n        this._info.h = arr[2] + (arr[3] << 8);\n        this._info.m = 1 & arr[4] >> 7;\n        this._info.cr = 7 & arr[4] >> 4;\n        this._info.s = 1 & arr[4] >> 3;\n        this._info.pixel = arr[4] & 0x07;\n        this._info.bgColor = arr[5];\n        this._info.radio = arr[6];\n        if (this._info.m) {\n            this._info.colorTab = this.read((2 << this._info.pixel) * 3);\n        }\n        this.decode();\n    }\n    private decode() {\n        let srcBuf = [];\n        let arr = this.read(1);\n        switch (arr[0]) {\n            case 33: //扩展块\n                this.extension();\n                break;\n            case 44: //图象标识符\n                arr = this.read(9);\n                this._frame.img = {\n                    x: arr[0] + (arr[1] << 8),\n                    y: arr[2] + (arr[3] << 8),\n                    w: arr[4] + (arr[5] << 8),\n                    h: arr[6] + (arr[7] << 8),\n                    colorTab: 0\n                };\n                this._frame.img.m = 1 & arr[8] >> 7;\n                this._frame.img.i = 1 & arr[8] >> 6;\n                this._frame.img.s = 1 & arr[8] >> 5;\n                this._frame.img.r = 3 & arr[8] >> 3;\n                this._frame.img.pixel = arr[8] & 0x07;\n                if (this._frame.img.m) {\n                    this._frame.img.colorTab = this.read((2 << this._frame.img.pixel) * 3);\n                }\n                this._frame.img.codeSize = this.read(1)[0];\n                srcBuf = [];\n                while (1) {\n                    arr = this.read(1);\n                    if (arr[0]) {\n                        this.read(arr[0]).forEach((e, i, arr) => {\n                            srcBuf.push(e);\n                        });\n                    } else {\n                        this._frame.img.srcBuf = srcBuf;\n                        this.decode();\n                        break;\n                    }\n                };\n                break;\n            case 59:\n                break;\n            default:\n                break;\n        }\n    }\n    private extension() {\n        var arr = this.read(1), o, s;\n        switch (arr[0]) {\n            case 255: //应用程序扩展\n                if (this.read(1)[0] == 11) {\n                    this._info.appVersion = '';\n                    this.read(11).forEach((e, i, arr) => {\n                        this._info.appVersion += String.fromCharCode(e);\n                    });\n                    while (1) {\n                        arr = this.read(1);\n                        if (arr[0]) {\n                            this.read(arr[0]);\n                        } else {\n                            this.decode();\n                            break;\n                        }\n                    };\n                } else {\n                    throw new Error('解析出错');\n                }\n                break;\n            case 249: //图形控制扩展\n                if (this.read(1)[0] == 4) {\n                    arr = this.read(4);\n                    this._frame = {};\n                    this._frame.ctrl = {\n                        disp: 7 & arr[0] >> 2,\n                        i: 1 & arr[0] >> 1,\n                        t: arr[0] & 0x01,\n                        delay: arr[1] + (arr[2] << 8),\n                        tranIndex: arr[3]\n                    };\n                    this._info.frames.push(this._frame);\n                    if (this.read(1)[0] == 0) {\n                        this.decode();\n                    } else {\n                        throw new Error('解析出错');\n                    }\n                } else {\n                    throw new Error('解析出错');\n                }\n                break;\n            case 254: //注释块\n                arr = this.read(1);\n                if (arr[0]) {\n                    this.read(arr[0]).forEach((e, i, arr) => {\n                        this._info.comment += String.fromCharCode(e);\n                    });\n                    if (this.read(1)[0] == 0) {\n                        this.decode();\n                    };\n                }\n                break;\n            default:\n                break;\n        }\n    }\n    private clear() {\n        this._tab = null;\n        this._view = null;\n        this._frame = null;\n        this._offset = 0;\n        this._info = {\n            header: '',\n            frames: [],\n            comment: ''\n        };\n        this._lastData = null;\n        this._delays = [];\n        this._spriteFrames = [];\n        this._canvas = null;\n        this._context = null;\n    }\n}\nclass GIFCache {\n    private static instance: GIFCache = null;\n    gifFrameMap = {}\n    static getInstance() {\n        if (!GIFCache.instance) {\n            GIFCache.instance = new GIFCache();\n            if(JSB){\n                assetManager.downloader.register('.gif', assetManager.downloader._downloaders['.binary']);\n\n            }else{\n                assetManager.downloader.register('.gif', (url, options, onComplete) => {\n                    // console.log(\"downloader\", url);\n                    assetManager.downloader._downloaders[\".bin\"](url, options, (err, data) => {\n                      if (!err) {\n                        // CC_JSB\n                        if (typeof data === \"string\") {\n                          assetManager.parser.parse(url, data, \".bin\", options, onComplete);\n                          return;\n                        }\n                      }\n                      onComplete(err, data);\n                    });\n                })\n\n            }\n\n\n            if (JSB) {\n                assetManager.parser.register('.gif', (file, options, onComplete) => {\n                    let gif = new GIF();\n                    console.log('>>> jsb-file:',file);\n                    let buffer = jsb.fileUtils.getDataFromFile(file);\n                    // console.log(buffer,' >>> buffer')\n                    gif.handle(buffer, onComplete);\n                })\n            } else {\n                assetManager.parser.register('.gif', (file, options, onComplete) => {\n                    let gif = new GIF();\n                    console.log('>>> web-file:',file);\n                    let buffer = file;\n                    if(file.arrayBuffer){\n                        buffer = file.arrayBuffer();\n                    }\n                    gif.handle(buffer, onComplete)\n                })\n            }\n        }\n        return GIFCache.instance;\n    }\n    preloadGif(data) {\n        try {\n            if (data.words) {\n                data.words.forEach(item => {\n                    if (item.indexOf(\".gif\") != -1)\n                        loader.load(item.img, (error, data) => { })\n                });\n            }\n            if (data.classes) {\n                data.classes.forEach(item => {\n                    if (item.indexOf(\".gif\") != -1)\n                        loader.load(item.img, (error, data) => { })\n                });\n            }\n        } catch (e) {\n            log(e)\n        }\n    }\n    addItemFrame(key: any, frameData: GIFFrameData) {\n        if (this.has(key) == true) {\n            let item = this.get(key)\n            item.referenceCount++\n            item.frameData = frameData\n        } else {\n            let gifCaheItem = { referenceCount: 0, type: FileType.GIF, frame: {} }\n            this.gifFrameMap[key] = gifCaheItem\n        }\n    }\n    addItemType(key: any, type: FileType) {\n        if (this.has(key)) {\n            let item = this.get(key)\n            item.type = type\n        } else {\n            let gifCaheItem = { referenceCount: 0, type: type, frame: null }\n            this.gifFrameMap[key] = gifCaheItem\n        }\n    }\n    add(key: any, value: GIFCaheItem) {\n        if (!this.has(key)) {\n            this.gifFrameMap[key] = value\n        }\n    }\n    get(key: any): GIFCaheItem {\n        return this.gifFrameMap[key]\n    }\n    has(key: any): boolean {\n        if (this.gifFrameMap[key] == undefined) {\n            return false\n        }\n        return true\n    }\n    hasFrame(key: any) {\n        let item = this.get(key)\n        if (item != undefined) {\n            let itemFrame = item.frameData\n            if (itemFrame != null) {\n                return true\n            }\n        }\n        return false\n    }\n    relase(key: any) {\n        if (this.has(key)) {\n            this.gifFrameMap[key] = undefined\n            loader.release(key)\n        }\n    }\n    releaseAll() {\n        for (const key in this.gifFrameMap) {\n            loader.release(key)\n        }\n        this.gifFrameMap = {}\n    }\n}\ninterface GIFFrameData {\n    delays: Array<number>,\n    spriteFrames: Array<SpriteFrame>,\n    length: number\n}\ninterface GIFCaheItem {\n    referenceCount: number,\n    type: FileType,\n    frameData: GIFFrameData\n}\nexport { GIF, GIFCache }\n\nexport class FileHead {\n    static IMAGE_PNG = \"89504e47\";\n    static IMAGE_JPG = \"ffd8ff\";\n    static IMAGE_GIF = \"474946\";\n// /**\n// * Webp\n// */\n    static RIFF = \"52494646\";\n    static WEBP_RIFF = FileHead.RIFF;\n    static WEBP_WEBP = \"57454250\";\n}\n\n"]}