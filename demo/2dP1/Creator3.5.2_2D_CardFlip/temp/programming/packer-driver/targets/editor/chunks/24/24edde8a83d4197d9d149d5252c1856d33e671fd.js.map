{"version":3,"sources":["file:///Users/mu/work/gitee/CocosCreatorDemos/demo/2dP1/Creator3.5.2_2D_CardFlip/assets/scripts/PopupBase.ts"],"names":["_decorator","Component","Node","BlockInputEvents","tween","DEV","ccclass","property","PopupBase","type","tooltip","animationDuration","blocker","options","finishCallback","show","duration","init","updateDisplay","onBeforeShow","undefined","playShowAnimation","onAfterShow","hide","suspended","node","addComponent","setParent","setContentSize","getContentSize","active","onBeforeHide","playHideAnimation","onAfterHide","Promise","res","background","main","opacity","scale","to","start","easing","call","delay","onSuspended"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, BlockInputEvents, tween } from 'cc';\nimport { DEV } from 'cc/env';\nconst { ccclass, property } = _decorator;\n\n/**\n* 弹窗基类\n* @author 陈皮皮 (ifaswind)\n* @version 20220122\n*/\n@ccclass('PopupBase')\nexport default class PopupBase<Options = any> extends Component {\n    @property({ type: Node, tooltip: DEV && '背景遮罩' })\n    public background: Node | null = null;\n    @property({ type: Node, tooltip: DEV && '弹窗主体' })\n    public main: Node | null = null;\n\n    /**\n    * 展示/隐藏动画的时长\n    */\n    public animationDuration: number = 0.3;\n\n    /**\n    * 用于拦截点击的节点\n    */\n    protected blocker: Node | null = null;\n\n    /**\n    * 弹窗选项\n    */\n    protected options: Options = null;\n\n    /**\n    * 展示弹窗\n    * @param options 弹窗选项\n    * @param duration 动画时长\n    */\n    public async show(options?: Options, duration?: number) {\n        // 储存选项\n        this.options = options;\n        // 初始化\n        this.init(options);\n        // 更新样式\n        this.updateDisplay(options);\n        // 弹窗回调\n        this.onBeforeShow && await this.onBeforeShow();\n        // 展示动画\n        if (duration == undefined) {\n            duration = duration < 0 ? 0 : this.animationDuration;\n        }\n        await this.playShowAnimation(duration);\n        // 弹窗回调\n        this.onAfterShow && this.onAfterShow();\n    }\n\n    /**\n    * 隐藏弹窗\n    * @param suspended 是否被挂起\n    * @param duration 动画时长\n    */\n    public async hide(suspended: boolean = false, duration?: number) {\n        const node = this.node;\n        // 动画时长不为 0 时拦截点击事件（避免误操作）\n        if (duration !== 0) {\n            let blocker = this.blocker;\n            if (!blocker) {\n                blocker = this.blocker = new Node('blocker');\n                blocker.addComponent(BlockInputEvents);\n                blocker.setParent(node);\n                blocker.setContentSize(node.getContentSize());\n            }\n            blocker.active = true;\n        }\n        // 弹窗回调\n        this.onBeforeHide && await this.onBeforeHide(suspended);\n        // 播放隐藏动画\n        if (duration == undefined) {\n        duration = duration < 0 ? 0 : this.animationDuration;\n        }\n        await this.playHideAnimation(duration);\n        // 关闭拦截\n        this.blocker && (this.blocker.active = false);\n        // 关闭节点\n        node.active = false;\n        // 弹窗回调\n        this.onAfterHide && this.onAfterHide(suspended);\n        // 弹窗完成回调\n        this.finishCallback && this.finishCallback(suspended);\n    }\n\n    /**\n    * 播放弹窗展示动画（派生类请重写此函数以实现自定义逻辑）\n    * @param duration 动画时长\n    */\n    protected playShowAnimation(duration: number): Promise<void> {\n        return new Promise<void>(res => {\n\n        // 初始化节点\n        const background = this.background,\n        main = this.main;\n        this.node.active = true;\n        background.active = true;\n        background.opacity = 0;\n        main.active = true;\n        main.scale = 0.5;\n        main.opacity = 0;\n\n        // 背景遮罩\n        tween(background)\n        .to(duration * 0.5, { opacity: 150 })\n        .start();\n\n        // 弹窗主体\n        tween(main)\n            .to(duration, { scale: 1, opacity: 255 }, { easing: 'backOut' })\n            .call(res)\n            .start();\n        });\n    }\n\n    /**\n    * 播放弹窗隐藏动画（派生类请重写此函数以实现自定义逻辑）\n    * @param duration 动画时长\n    */\n    protected playHideAnimation(duration: number): Promise<void> {\n        return new Promise<void>(res => {\n\n        // 背景遮罩\n        tween(this.background)\n            .delay(duration * 0.5)\n            .to(duration * 0.5, { opacity: 0 })\n        .start();\n\n        // 弹窗主体\n        tween(this.main)\n            .to(duration, { scale: 0.5, opacity: 0 }, { easing: 'backIn' })\n            .call(res)\n            .start();\n        });\n    }\n\n    /**\n     * 初始化（派生类请重写此函数以实现自定义逻辑）\n     * @param options 弹窗选项\n     */\n    protected init(options: Options) {\n\n    }\n\n    /**\n     * 更新样式（派生类请重写此函数以实现自定义逻辑）\n     * @param options 弹窗选项\n     */\n    protected updateDisplay(options: Options) {\n\n    }\n\n    /**\n     * 弹窗展示前（派生类请重写此函数以实现自定义逻辑）\n     */\n    protected onBeforeShow(): Promise<void> {\n        return new Promise(res => res());\n    }\n\n    /**\n     * 弹窗展示后（派生类请重写此函数以实现自定义逻辑）\n     */\n    protected onAfterShow() {\n\n    }\n\n    /**\n     * 弹窗隐藏前（派生类请重写此函数以实现自定义逻辑）\n     * @param suspended 是否被挂起\n     */\n    protected onBeforeHide(suspended: boolean): Promise<void> {\n        return new Promise(res => res());\n    }\n\n    /**\n     * 弹窗隐藏后（派生类请重写此函数以实现自定义逻辑）\n     * @param suspended 是否被挂起\n     */\n    protected onAfterHide(suspended: boolean) {\n\n    }\n\n    /**\n     * 弹窗被挂起（派生类请重写此函数以实现自定义逻辑）\n     */\n    protected onSuspended(): Promise<void> {\n        return new Promise(res => res());\n    }\n\n    /**\n    * 弹窗流程结束回调（注意：该回调为 PopupManager 专用，重写 hide 函数时记得调用该回调）\n    */\n    protected finishCallback: (suspended: boolean) => void = null;\n}\n"]}