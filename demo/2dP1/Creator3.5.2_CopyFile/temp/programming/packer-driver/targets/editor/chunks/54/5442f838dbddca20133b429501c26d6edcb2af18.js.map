{"version":3,"sources":["file:///Users/mu/work/gitee/CocosCreatorDemos/demo/Creator3.5.2_CopyFile/assets/main.ts"],"names":["_decorator","Component","find","Label","sys","NATIVE","ccclass","property","main","copyFromWeb","str","input","el","document","createElement","value","setAttribute","style","contain","position","left","fontSize","selection","getSelection","originalRange","rangeCount","getRangeAt","body","appendChild","select","selectionStart","selectionEnd","length","success","execCommand","err","console","log","removeChild","removeAllRanges","addRange","copyFromiOSWeb","textString","querySelector","id","readOnly","zIndex","selectText","blur","textbox","startIndex","stopIndex","createTextRange","range","collapse","moveStart","moveEnd","setSelectionRange","focus","onClickCopy","getComponent","string","platform","Platform","ANDROID","jsb","reflection","callStaticMethod","IOS","MACOS"],"mappings":";;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAAgBC,MAAAA,G,OAAAA,G;;AACnDC,MAAAA,M,UAAAA,M;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;sBAGjBQ,I,WADZF,OAAO,CAAC,MAAD,C,gBAAR,MACaE,IADb,SAC0BP,SAD1B,CACoC;AAChC;AACAQ,QAAAA,WAAW,CAAEC,GAAF,EAAe;AACtB,cAAIC,KAAK,GAAGD,GAAG,GAAG,EAAlB;AACA,gBAAME,EAAE,GAAGC,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAX;AACAF,UAAAA,EAAE,CAACG,KAAH,GAAWJ,KAAX;AACAC,UAAAA,EAAE,CAACI,YAAH,CAAgB,UAAhB,EAA4B,EAA5B;AACAJ,UAAAA,EAAE,CAACK,KAAH,CAASC,OAAT,GAAmB,QAAnB;AACAN,UAAAA,EAAE,CAACK,KAAH,CAASE,QAAT,GAAoB,UAApB;AACAP,UAAAA,EAAE,CAACK,KAAH,CAASG,IAAT,GAAgB,SAAhB;AACAR,UAAAA,EAAE,CAACK,KAAH,CAASI,QAAT,GAAoB,MAApB,CARsB,CAQM;;AAC5B,gBAAMC,SAAS,GAAGC,YAAY,EAA9B;AACA,cAAIC,aAAa,GAAG,KAApB;;AACA,cAAIF,SAAS,CAACG,UAAV,GAAuB,CAA3B,EAA8B;AAC1B;AACAD,YAAAA,aAAa,GAAGF,SAAS,CAACI,UAAV,CAAqB,CAArB,CAAhB;AACH;;AACDb,UAAAA,QAAQ,CAACc,IAAT,CAAcC,WAAd,CAA0BhB,EAA1B;AACAA,UAAAA,EAAE,CAACiB,MAAH;AACAjB,UAAAA,EAAE,CAACkB,cAAH,GAAoB,CAApB;AACAlB,UAAAA,EAAE,CAACmB,YAAH,GAAkBpB,KAAK,CAACqB,MAAxB;AACA,cAAIC,OAAO,GAAG,KAAd;;AACA,cAAI;AACAA,YAAAA,OAAO,GAAGpB,QAAQ,CAACqB,WAAT,CAAqB,MAArB,CAAV;AACH,WAFD,CAEE,OAAOC,GAAP,EAAY;AACVC,YAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBF,GAApB;AACH;;AACDtB,UAAAA,QAAQ,CAACc,IAAT,CAAcW,WAAd,CAA0B1B,EAA1B;;AACA,cAAIY,aAAJ,EAAmB;AACfF,YAAAA,SAAS,CAACiB,eAAV,GADe,CAEf;;AACAjB,YAAAA,SAAS,CAACkB,QAAV,CAAmBhB,aAAnB;AACH;;AACD,iBAAOS,OAAP;AACH,SAlC+B,CAoChC;;;AACAQ,QAAAA,cAAc,CAAE/B,GAAF,EAAe;AACzB,gBAAMgC,UAAU,GAAGhC,GAAG,GAAE,EAAxB;AACA,cAAIC,KAAK,GAAGE,QAAQ,CAAC8B,aAAT,CAAuB,aAAvB,CAAZ;;AACA,cAAI,CAAChC,KAAL,EAAY;AACRA,YAAAA,KAAK,GAAGE,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAR;AACAH,YAAAA,KAAK,CAACiC,EAAN,GAAW,YAAX,CAFQ,CAGR;AACA;;AACAjC,YAAAA,KAAK,CAACkC,QAAN,GAAiB,IAAjB,CALQ,CAMR;;AACAlC,YAAAA,KAAK,CAACM,KAAN,CAAYE,QAAZ,GAAuB,UAAvB,CAPQ,CAQR;;AACAR,YAAAA,KAAK,CAACM,KAAN,CAAYG,IAAZ,GAAmB,SAAnB,CATQ,CAUR;;AACAT,YAAAA,KAAK,CAACM,KAAN,CAAY6B,MAAZ,GAAqB,OAArB;AACAjC,YAAAA,QAAQ,CAACc,IAAT,CAAcC,WAAd,CAA0BjB,KAA1B;AACH,WAhBwB,CAiBzB;AACA;;;AACAA,UAAAA,KAAK,CAACI,KAAN,GAAc2B,UAAd,CAnByB,CAoBzB;;AACA/B,UAAAA,KAAK,CAACkB,MAAN;AACAkB,UAAAA,UAAU,CAACpC,KAAD,EAAQ,CAAR,EAAW+B,UAAU,CAACV,MAAtB,CAAV;AACAI,UAAAA,OAAO,CAACC,GAAR,CAAYxB,QAAQ,CAACqB,WAAT,CAAqB,MAArB,CAAZ,EAA0C,aAA1C;;AACA,cAAIrB,QAAQ,CAACqB,WAAT,CAAqB,MAArB,CAAJ,EAAkC;AAC9BrB,YAAAA,QAAQ,CAACqB,WAAT,CAAqB,MAArB;AACH,WA1BwB,CA2BzB;AACA;;;AACAvB,UAAAA,KAAK,CAACqC,IAAN,GA7ByB,CA8BzB;;AACA,mBAASD,UAAT,CAAoBE,OAApB,EAA6BC,UAA7B,EAAyCC,SAAzC,EAAoD;AAChD,gBAAIF,OAAO,CAACG,eAAZ,EAA6B;AACzB,oBAAMC,KAAK,GAAGJ,OAAO,CAACG,eAAR,EAAd;AACAC,cAAAA,KAAK,CAACC,QAAN,CAAe,IAAf,EAFyB,CAGzB;;AACAD,cAAAA,KAAK,CAACE,SAAN,CAAgB,WAAhB,EAA6BL,UAA7B,EAJyB,CAKzB;;AACAG,cAAAA,KAAK,CAACG,OAAN,CAAc,WAAd,EAA2BL,SAAS,GAAGD,UAAvC;AACAG,cAAAA,KAAK,CAACxB,MAAN;AACH,aARD,MAQO;AACHoB,cAAAA,OAAO,CAACQ,iBAAR,CAA0BP,UAA1B,EAAsCC,SAAtC;AACAF,cAAAA,OAAO,CAACS,KAAR;AACH;AACJ;AACJ;;AAEDC,QAAAA,WAAW,GAAI;AACX,cAAIjD,GAAG,GAAGR,IAAI,CAAC,kBAAD,CAAJ,CAAyB0D,YAAzB,CAAsCzD,KAAtC,EAA6C0D,MAAvD;;AAEA,cAAI,CAACxD,MAAL,EAAa;AACT,iBAAKI,WAAL,CAAiBC,GAAjB;AACH,WAFD,MAEO;AACH,gBAAIN,GAAG,CAAC0D,QAAJ,IAAgB1D,GAAG,CAAC2D,QAAJ,CAAaC,OAAjC,EAA0C;AACtCC,cAAAA,GAAG,CAACC,UAAJ,CAAeC,gBAAf,CAAgC,4BAAhC,EACI,iBADJ,EAEI,uBAFJ,EAGIzD,GAHJ;AAIH,aALD,MAKO,IAAIN,GAAG,CAAC0D,QAAJ,IAAgB1D,GAAG,CAAC2D,QAAJ,CAAaK,GAA7B,IAAoChE,GAAG,CAAC0D,QAAJ,IAAgB1D,GAAG,CAAC2D,QAAJ,CAAaM,KAArE,EAA4E;AAC/EJ,cAAAA,GAAG,CAACC,UAAJ,CAAeC,gBAAf,CAAgC,gBAAhC,EACI,kBADJ,EAEIzD,GAFJ;AAGH;AACJ;AACJ;;AArG+B,O","sourcesContent":["import { _decorator, Component, Node, find, Label, EditBox, sys } from 'cc';\nimport { NATIVE } from 'cc/env';\nconst { ccclass, property } = _decorator;\n\n@ccclass('main')\nexport class main extends Component {\n    // web 上复制\n    copyFromWeb (str: string) {\n        var input = str + '';\n        const el = document.createElement('textarea');\n        el.value = input;\n        el.setAttribute('readonly', '');\n        el.style.contain = 'strict';\n        el.style.position = 'absolute';\n        el.style.left = '-9999px';\n        el.style.fontSize = '12pt'; // Prevent zooming on iOS\n        const selection = getSelection();\n        var originalRange = false;\n        if (selection.rangeCount > 0) {\n            // @ts-ignore\n            originalRange = selection.getRangeAt(0);\n        }\n        document.body.appendChild(el);\n        el.select();\n        el.selectionStart = 0;\n        el.selectionEnd = input.length;\n        var success = false;\n        try {\n            success = document.execCommand('copy');\n        } catch (err) {\n            console.log('err:', err);\n        }\n        document.body.removeChild(el);\n        if (originalRange) {\n            selection.removeAllRanges();\n            // @ts-ignore\n            selection.addRange(originalRange);\n        }\n        return success;\n    }\n\n    // 备用：解决 iOS web 剪切板问题\n    copyFromiOSWeb (str: string) { \n        const textString = str +'';\n        let input = document.querySelector('#copy-input');\n        if (!input) { \n            input = document.createElement('input');\n            input.id = \"copy-input\";\n            // 防止ios聚焦触发键盘事件 \n            // @ts-ignore\n            input.readOnly = true; \n            // @ts-ignore\n            input.style.position = \"absolute\";\n            // @ts-ignore\n            input.style.left = \"-1000px\";\n            // @ts-ignore\n            input.style.zIndex = \"-1000\";\n            document.body.appendChild(input);\n        }\n        // ios必须先选中文字且不支持\n        // @ts-ignore\n        input.value = textString; \n        // @ts-ignore\n        input.select();\n        selectText(input, 0, textString.length);\n        console.log(document.execCommand('copy'), 'execCommand');\n        if (document.execCommand('copy')) {\n            document.execCommand('copy');\n        }\n        // input 自带的 select() 方法在苹果端无法进行选择，所以需要自己去写一个类似的方法 \n        // @ts-ignore\n        input.blur(); \n        // 选择文本。createTextRange(setSelectionRange)是 input 方法 \n        function selectText(textbox, startIndex, stopIndex) {\n            if (textbox.createTextRange) { \n                const range = textbox.createTextRange(); \n                range.collapse(true);\n                // 起始光标\n                range.moveStart('character', startIndex);\n                // 结束光标\n                range.moveEnd('character', stopIndex - startIndex);\n                range.select();\n            } else {\n                textbox.setSelectionRange(startIndex, stopIndex); \n                textbox.focus(); \n            }\n        }\n    }\n\n    onClickCopy () {\n        let str = find('Canvas/copyLabel').getComponent(Label).string;\n\n        if (!NATIVE) {\n            this.copyFromWeb(str);\n        } else {\n            if (sys.platform == sys.Platform.ANDROID) {\n                jsb.reflection.callStaticMethod(\"com/cocos/game/AppActivity\",\n                    \"CopyToClipboard\",\n                    \"(Ljava/lang/String;)V\",\n                    str);\n            } else if (sys.platform == sys.Platform.IOS || sys.platform == sys.Platform.MACOS) {\n                jsb.reflection.callStaticMethod(\"ViewController\",\n                    \"CopyToClipboard:\",\n                    str);\n            }\n        }\n    }\n}"]}