{"version":3,"sources":["file:///Users/mu/Desktop/Creator3.5.2_2D_LightningWhip/assets/Lightning.ts"],"names":["_decorator","Component","Node","Line","Vec3","ccclass","property","up","Lightning","line","points","onLoad","getComponent","start","update","deltaTime","startPos","ZERO","endPos","i","targetNode","length","position","add","multiplyScalar","yOffset","showLight","collectLinPos","destPos","displace","detail","push","midX","x","midY","y","midZ","z","Math","random","midPos","equals","displacement","positions"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Line, Material, EffectAsset, Vec3, ModelComponent, Texture2D, CCFloat } from \"cc\";\nconst { ccclass, property } = _decorator;\n\nconst up:Vec3 = new Vec3(0, 1, 0);\n\n@ccclass(\"Lightning\")\nexport class Lightning extends Component {\n    @property()\n    detail:number = 1;\n    @property()\n    displacement:number = 15;\n    @property()\n    yOffset:number = 0;\n\n\n    @property(Node)\n    startNode:Node = null;\n    @property([Node])\n    targetNode:Array<Node> = [];\n\n    line: Line = null;\n    points:Vec3[];\n\n    onLoad () {\n        this.line = this.getComponent(Line);\n        this.points = [];\n    }\n\n    start () {\n    }\n\n    update (deltaTime: number) {\n        let startPos:Vec3 = Vec3.ZERO;\n        let endPos:Vec3 = Vec3.ZERO;\n\n        // if(this.startNode) {\n        //     startPos = this.startNode.position.add(up.multiplyScalar(this.yOffset));\n        // }\n        // if(this.targetNode) {\n        //     endPos = this.targetNode.position.add(up.multiplyScalar(this.yOffset));\n        // }\n        for(let i =0;i<this.targetNode.length-1;i++){\n            startPos = this.targetNode[i].position.add(up.multiplyScalar(this.yOffset))\n            endPos = this.targetNode[i+1].position.add(up.multiplyScalar(this.yOffset))\n            this.showLight(startPos,endPos);\n        }\n    }\n\n\n    //收集顶点，中点分形法插值抖动\n    collectLinPos(startPos:Vec3, destPos:Vec3, displace:number) {\n        if (displace < this.detail) {\n            this.points.push(startPos);\n        }\n        else {\n            let midX:number = (startPos.x + destPos.x) / 2;\n            let midY:number = (startPos.y + destPos.y) / 2;\n            let midZ:number = (startPos.z + destPos.z) / 2;\n\n            midX += (Math.random() - 0.5) * displace;\n            midY += (Math.random() - 0.5) * displace;\n            midZ += (Math.random() - 0.5) * displace;\n\n            let midPos:Vec3 = new Vec3(midX,midY,midZ);\n\n            this.collectLinPos(startPos, midPos, displace / 2);\n            this.collectLinPos(midPos, destPos, displace / 2);\n        }\n    }\n\n    showLight(startPos:Vec3,endPos:Vec3){\n        if(!startPos.equals(endPos)) {\n            this.points.length = 0;\n            this.collectLinPos(startPos, endPos, this.displacement);\n            this.points.push(endPos);\n            // @ts-ignore\n            this.line.positions = this.points;\n        }\n    }\n}"]}