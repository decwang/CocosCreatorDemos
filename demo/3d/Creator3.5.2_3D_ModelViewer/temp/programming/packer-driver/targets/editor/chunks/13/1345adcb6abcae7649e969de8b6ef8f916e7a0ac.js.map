{"version":3,"sources":["file:///Users/mu/work/gitee/CocosCreatorDemos/demo/3d/Creator3.5.2_3D_ModelViewer/assets/src/UIMgr.ts"],"names":["UIMgr","_decorator","Node","Prefab","loader","instantiate","find","Widget","UITransform","view","ResolutionPolicy","resources","screen","ccclass","property","UILayer","inst","_inst","resize","dr","getDesignResolutionSize","s","windowSize","rw","width","rh","height","finalW","finalH","setDesignResolutionSize","UNKNOWN","cvs","getComponent","setContentSize","setup","maxLayers","canvas","node","children","length","i","layerNode","layer","uiTransfrom","addComponent","widget","isAlignBottom","isAlignTop","isAlignLeft","isAlignRight","left","right","top","bottom","addChild","getLayerNode","layerIndex","showUI","uiCls","cb","target","ui","resArr","getRes","push","prefabUrl","loadResArray","load","err","prefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, loader, instantiate, find, Widget, UITransform, view, ResolutionPolicy, resources, screen } from 'cc';\nimport { UIController } from './UIController';\nconst { ccclass, property } = _decorator;\n\nexport enum UILayer{\n    SCENE,\n    GAME,\n    HUD,\n    POPUP,\n    ALERT,\n    NOTICE,\n    MASK,\n    NUM\n}\n\nexport class UIMgr {\n    private static _inst: UIMgr = null;\n    public static get inst(): UIMgr {\n        if (!this._inst) {\n            this._inst = new UIMgr();\n        }\n        return this._inst;\n    }\n\n    public resize() {\n        //根据屏幕大小决定适配策略\n        //想明白原理，请阅读本文 https://blog.csdn.net/qq_36720848/article/details/89742451\n\n        //decide the resolution policy according to the relationship between screen size and design resolution.  go https://blog.csdn.net/qq_36720848/article/details/89742451 (artile in Chinese) for more detail.\n        let dr = view.getDesignResolutionSize();\n        var s = screen.windowSize;\n        var rw = s.width;\n        var rh = s.height;\n        var finalW = rw;\n        var finalH = rh;\n\n        //\n        if((rw/rh) > (dr.width / dr.height)){\n            //如果更长，则用定高\n            //if screen size is longer than design resolution. use fitHeight\n            finalH = dr.height;\n            finalW = finalH * rw/rh;\n        }\n        else{\n            //如果更短，则用定宽\n            //if screen size is shorter than design resolution. use fitWidth.\n            finalW = dr.width;\n            finalH = rh/rw * finalW;\n        }\n\n        //手工修改canvas和设计分辨率，这样反复调用也能生效。\n        //we use the code below instead of fitWidth = true or fitHeight = true. so that we can recall this method many times.\n        view.setDesignResolutionSize(finalW,finalH,ResolutionPolicy.UNKNOWN);\n        let cvs = find('Canvas').getComponent(UITransform);\n        // cvs.node.width = finalW;\n        // cvs.node.height = finalH;\n\n        cvs.setContentSize(finalW, finalH);\n    }\n\n    public setup(maxLayers:number){\n        this.resize();\n        let canvas = find('Canvas').getComponent(UITransform);\n        if(canvas.node.children.length){\n            return;\n        }\n        \n        for(let i = 0; i < maxLayers; ++i){\n            let layerNode = new Node();\n            layerNode.layer = canvas.node.layer;\n            let uiTransfrom = layerNode.addComponent(UITransform);\n            uiTransfrom.width = canvas.width;\n            uiTransfrom.height = canvas.height;\n            \n            let widget = layerNode.addComponent(Widget);\n            widget.isAlignBottom = true;\n            widget.isAlignTop = true;\n            widget.isAlignLeft = true;\n            widget.isAlignRight = true;\n\n            widget.left = 0;\n            widget.right = 0;\n            widget.top = 0;\n            widget.bottom = 0;\n            canvas.node.addChild(layerNode);\n        }\n    }\n\n    public getLayerNode (layerIndex:number) : Node {\n        let canvas = find('Canvas');\n        return canvas.children[layerIndex];\n    }\n\n    public showUI(uiCls: any, cb?: Function,target?:any):any {\n        let ui = new uiCls() as UIController;\n        let resArr = ui.getRes() || [];\n        resArr.push(ui.prefabUrl as never);\n        \n        loader.loadResArray(resArr, () => {\n            if (ui.prefabUrl) {\n                resources.load(ui.prefabUrl, Prefab, (err: any, prefab: Prefab) => {\n                    if (err) return;\n\n                    let node = instantiate(prefab);\n                    ui.setup(node);\n                });\n            }\n            else{\n                //special for empty ui\n                let node = new Node();\n                node.layer = find('Canvas').layer;\n\n                //keep size\n                let widget = node.addComponent(Widget);\n                widget.isAlignBottom = true;\n                widget.isAlignTop = true;\n                widget.isAlignLeft = true;\n                widget.isAlignRight = true;\n    \n                widget.left = 0;\n                widget.right = 0;\n                widget.top = 0;\n                widget.bottom = 0;\n                ui.setup(node);\n            }\n        });\n        return ui;\n    }\n}\n"]}